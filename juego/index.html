<!DOCTYPE html>
<html>
  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lora&family=Moon+Dance&display=swap"
      rel="stylesheet"
    />
    <script src="https://pixijs.download/release/pixi.js"></script>
    <script src="./keyboard.js"></script>
    <script src="./terror.js"></script>
    <script src="./enemies.js"></script>
    <script src="./text.js"></script>
  </head>
  <body>
    <script>
      const velocidad = 4;
      const width = window.innerWidth - 50;
      const height = window.innerHeight - 50;
      let app = new PIXI.Application({
        width: width,
        height: height,
        backgroundColor: 0x59bee3,
      });

      document.body.appendChild(app.view);
      const background = PIXI.Sprite.from("../assets/background.png");
      const container = new PIXI.Container();
      container.addChild(background);
      const terror = initTerror(height, width);
      const abeja = initAbeja(height, width);
      const texto = lifeText(width);
      const textoMuerte = deadText(height, width);
      const timer = timerText();

      const ticker = app.ticker;
      let seconds = 0;
      const graphics = new PIXI.Graphics();
      const containerMuerte = new PIXI.Container();
      containerMuerte.addChild(graphics);
      containerMuerte.addChild(textoMuerte);
      // Rectangle
      graphics.beginFill(0x000000);
      graphics.alpha = 0.8;
      graphics.drawRect(0, 0, width, height);
      graphics.endFill();
      app.stage.addChild(container);
      app.stage.addChild(abeja);
      app.stage.addChild(terror);
      app.stage.addChild(timer);
      app.stage.addChild(texto);
      const right = keyboard("ArrowRight");
      const left = keyboard("ArrowLeft");
      const up = keyboard("ArrowUp");
      const down = keyboard("ArrowDown");

      up.press = () => {
        if (terror.alive === true) {
          terror.vy = -velocidad;
        }
      };
      up.release = () => {
        terror.vy = 0;
      };

      down.press = () => {
        if (terror.alive === true) {
          terror.vy = velocidad;
        }
      };
      down.release = () => {
        terror.vy = 0;
      };

      left.press = () => {
        if (terror.alive === true) {
          terror.vx = -velocidad;
          terror.scale.x = -terror.scaleBase;
        }
      };
      left.release = () => {
        terror.vx = 0;
      };

      right.press = () => {
        if (terror.alive === true) {
          terror.vx = velocidad;
          terror.scale.x = terror.scaleBase;
        }
      };
      right.release = () => {
        terror.vx = 0;
      };
      let toque = 0;
      ticker.add((delta) => {
        seconds += (1 / 60) * delta;
        console.log(Math.floor(seconds));
        timer.text = "Segundos: " + Math.floor(seconds);
        texto.text = "vidas: " + terror.lives;
        //////
        const abejaRigth = abeja.x + abeja.width / 2;
        const abejaLeft = abeja.x - abeja.width / 2;
        const abejaTop = abeja.y - abeja.height / 2;
        const abejaBottom = abeja.y + abeja.height / 2;
        if (abejaRigth + abeja.vx < width && abejaLeft + abeja.vx > 0) {
          abeja.x = abeja.x + abeja.vx;
        }
        if (abejaLeft + abeja.vx <= 0 || abejaRigth + abeja.vx >= width) {
          abeja.scale.x *= -1;
          abeja.vx *= -1;
        }

        ////
        const terrorRigth = terror.x + terror.width / 2;
        const terrorLeft = terror.x - terror.width / 2;
        const terrorTop = terror.y - terror.height / 2;
        const terrorBottom = terror.y + terror.height / 2;
        if (terrorRigth + terror.vx < width && terrorLeft + terror.vx > 0) {
          terror.x = terror.x + terror.vx;
        }
        if (terrorTop + terror.vy > 0 && terrorBottom + terror.vy < height) {
          terror.y = terror.y + terror.vy;
        }

        const abejaRigthTouchesTerror =
          abejaRigth >= terrorLeft && abejaRigth <= terrorRigth;

        const abejaBottomTouchesTerror =
          abejaBottom <= terrorBottom && abejaBottom >= terrorTop;

        const abejaTopTocuhesTerror =
          abejaTop <= terrorBottom && abejaTop >= terrorTop;

        const abejaLeftTouchesTerror =
          abejaLeft <= terrorRigth && abejaLeft >= terrorLeft;

        const firstCondition =
          abejaRigthTouchesTerror && abejaBottomTouchesTerror;
        const secondCondition =
          abejaRigthTouchesTerror && abejaTopTocuhesTerror;
        const thirdCondition =
          abejaLeftTouchesTerror && abejaBottomTouchesTerror;
        const fourthCondition = abejaLeftTouchesTerror && abejaTopTocuhesTerror;
        if (
          firstCondition ||
          secondCondition ||
          thirdCondition ||
          fourthCondition
        ) {
          toque++;
          if (toque >= 100 && terror.lives > 0) {
            terror.lives -= 1;
            toque = 0;
            if (terror.lives <= 0) {
              terror.alive = false;
              abeja.vx = 0;
              abeja.stop();
              terror.stop();
              app.stage.addChild(containerMuerte);
            }
          }
        }
      });
    </script>
  </body>
</html>
